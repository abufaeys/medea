<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Medea's e2e test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/6.2.0/mocha.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.2.0/chai.js"></script>
    <!--Include all helpers from e2e-tests/helpers dir-->
    <helpers/>
    <script type="module">
        import init, {Jason} from "/.cache/jason-pkg/medea_jason.js";

        let jason;

        async function getJason() {
            if (jason === undefined) {
                await init();
                jason = new Jason();
                return jason;
            } else {
                return jason;
            }
        }

        window.getJason = getJason;
    </script>
</head>

<body>
<div id="mocha"></div>
<script>
    // This is needed for retrieving Mocha results from 'e2e-tests-runner'
    console.stdlog = console.log.bind(console);
    console.logs = [];
    console.log = function() {
        console.logs.push(Array.from(arguments));
        console.stdlog.apply(console, arguments);
    };

    mocha.setup({
        ui: 'bdd',
        reporter: 'json'
    });

    // Root 'after()' for signal for 'e2e-test-runner' that tests done.
    after(() => {
        let successEl = document.createElement('div');
        successEl.id = 'test-end';
        document.body.appendChild(successEl);
    });
</script>

<!--Include a file with mocha tests-->
<script src="/e2e-tests/{{{test}}}"></script>

<script>
    setTimeout(() => mocha.run(), 1);
</script>
</body>

</html>
